##@ üîç Qualidade de C√≥digo - PHP Insights

phpinsights-install: ## Instala PHP Insights
	@echo "$(GREEN)üì¶ Instalando PHP Insights...$(NC)"
	docker compose exec php composer require --dev nunomaduro/phpinsights
	@echo "$(GREEN)‚úÖ PHP Insights instalado!$(NC)"
	@echo "$(YELLOW)üí° Execute: make phpinsights-analyze$(NC)"

phpinsights-analyze: ## Analisa c√≥digo com PHP Insights
	@echo "$(GREEN)üîç Analisando c√≥digo com PHP Insights...$(NC)"
	docker compose exec php ./vendor/bin/phpinsights analyse backend/app --min-quality=80 --min-complexity=80 --min-architecture=80 --min-style=80 || true

phpinsights-analyze-simple: ## An√°lise simples (sem m√©tricas m√≠nimas)
	@echo "$(GREEN)üîç An√°lise simples com PHP Insights...$(NC)"
	docker compose exec php ./vendor/bin/phpinsights analyse backend/app

phpinsights-fix: ## Corrige problemas automaticamente (quando poss√≠vel)
	@echo "$(YELLOW)üîß Corrigindo problemas automaticamente...$(NC)"
	docker compose exec php ./vendor/bin/phpinsights analyse backend/app --fix || true

phpinsights-config: ## Gera arquivo de configura√ß√£o phpinsights.php
	@echo "$(GREEN)‚öôÔ∏è  Gerando configura√ß√£o do PHP Insights...$(NC)"
	docker compose exec php ./vendor/bin/phpinsights --init || true


##@ üéØ PHPStan - An√°lise Est√°tica

phpstan-install: ## Instala PHPStan
	@echo "$(GREEN)üì¶ Instalando PHPStan...$(NC)"
	docker compose exec php composer require --dev phpstan/phpstan phpstan/extension-installer
	@echo "$(GREEN)‚úÖ PHPStan instalado!$(NC)"

phpstan-analyze: ## Analisa c√≥digo com PHPStan (n√≠vel 0)
	@echo "$(GREEN)üîç Analisando c√≥digo com PHPStan...$(NC)"
	docker compose exec php ./vendor/bin/phpstan analyse backend/app --memory-limit=2G || true

phpstan-analyze-level: ## Analisa com n√≠vel espec√≠fico (0-9)
	@read -p "N√≠vel de an√°lise (0-9, padr√£o: 5): " level; \
	level=$${level:-5}; \
	echo "$(GREEN)üîç Analisando com n√≠vel $$level...$(NC)"; \
	docker compose exec php ./vendor/bin/phpstan analyse backend/app --level=$$level --memory-limit=2G || true

phpstan-analyze-strict: ## An√°lise rigorosa (n√≠vel 9)
	@echo "$(GREEN)üîç An√°lise rigorosa com PHPStan (n√≠vel 9)...$(NC)"
	docker compose exec php ./vendor/bin/phpstan analyse backend/app --level=9 --memory-limit=2G || true

phpstan-baseline: ## Gera baseline para ignorar erros existentes
	@echo "$(YELLOW)üìù Gerando baseline do PHPStan...$(NC)"
	docker compose exec php ./vendor/bin/phpstan analyse backend/app --generate-baseline --memory-limit=2G || true

phpstan-clear-result-cache: ## Limpa cache de resultados do PHPStan
	@echo "$(YELLOW)üßπ Limpando cache do PHPStan...$(NC)"
	docker compose exec php ./vendor/bin/phpstan clear-result-cache || true


##@ üé® PHP CS Fixer - Formata√ß√£o de C√≥digo

phpcs-install: ## Instala PHP CS Fixer
	@echo "$(GREEN)üì¶ Instalando PHP CS Fixer...$(NC)"
	docker compose exec php composer require --dev friendsofphp/php-cs-fixer
	@echo "$(GREEN)‚úÖ PHP CS Fixer instalado!$(NC)"

phpcs-check: ## Verifica estilo de c√≥digo (sem alterar)
	@echo "$(GREEN)üîç Verificando estilo de c√≥digo...$(NC)"
	docker compose exec php ./vendor/bin/php-cs-fixer fix --dry-run --diff backend/app || true

phpcs-fix: ## Corrige estilo de c√≥digo automaticamente
	@echo "$(GREEN)üîß Corrigindo estilo de c√≥digo...$(NC)"
	docker compose exec php ./vendor/bin/php-cs-fixer fix backend/app

phpcs-config: ## Gera arquivo de configura√ß√£o .php-cs-fixer.php
	@echo "$(GREEN)‚öôÔ∏è  Gerando configura√ß√£o do PHP CS Fixer...$(NC)"
	docker compose exec php ./vendor/bin/php-cs-fixer --init || true


##@ üé® Laravel Pint - Formata√ß√£o Moderna

pint-install: ## Instala Laravel Pint
	@echo "$(GREEN)üì¶ Instalando Laravel Pint...$(NC)"
	docker compose exec php composer require --dev laravel/pint
	@echo "$(GREEN)‚úÖ Laravel Pint instalado!$(NC)"

pint-check: ## Verifica formata√ß√£o (sem alterar)
	@echo "$(GREEN)üîç Verificando formata√ß√£o com Pint...$(NC)"
	docker compose exec php ./vendor/bin/pint --test backend/app || true

pint-fix: ## Corrige formata√ß√£o automaticamente
	@echo "$(GREEN)üîß Corrigindo formata√ß√£o com Pint...$(NC)"
	docker compose exec php ./vendor/bin/pint backend/app


##@ üêõ PHPMD - PHP Mess Detector

phpmd-install: ## Instala PHPMD
	@echo "$(GREEN)üì¶ Instalando PHPMD...$(NC)"
	docker compose exec php composer require --dev phpmd/phpmd
	@echo "$(GREEN)‚úÖ PHPMD instalado!$(NC)"

phpmd-analyze: ## Analisa c√≥digo com PHPMD
	@echo "$(GREEN)üîç Analisando c√≥digo com PHPMD...$(NC)"
	docker compose exec php ./vendor/bin/phpmd backend/app text codesize,unusedcode,naming,design,controversial,cleancode || true

phpmd-analyze-xml: ## An√°lise PHPMD em formato XML
	@read -p "Arquivo de sa√≠da (ex: phpmd-report.xml): " file; \
	echo "$(GREEN)üîç Gerando relat√≥rio XML...$(NC)"; \
	docker compose exec php ./vendor/bin/phpmd backend/app xml codesize,unusedcode,naming,design,controversial,cleancode > $$file || true


##@ üìä Psalm - An√°lise Est√°tica Avan√ßada

psalm-install: ## Instala Psalm
	@echo "$(GREEN)üì¶ Instalando Psalm...$(NC)"
	docker compose exec php composer require --dev vimeo/psalm
	@echo "$(GREEN)‚úÖ Psalm instalado!$(NC)"

psalm-init: ## Inicializa Psalm no projeto
	@echo "$(GREEN)‚öôÔ∏è  Inicializando Psalm...$(NC)"
	docker compose exec php ./vendor/bin/psalm --init || true

psalm-analyze: ## Analisa c√≥digo com Psalm
	@echo "$(GREEN)üîç Analisando c√≥digo com Psalm...$(NC)"
	docker compose exec php ./vendor/bin/psalm --memory-limit=2G || true

psalm-baseline: ## Gera baseline do Psalm
	@echo "$(YELLOW)üìù Gerando baseline do Psalm...$(NC)"
	docker compose exec php ./vendor/bin/psalm --set-baseline=psalm-baseline.xml || true

psalm-clear-cache: ## Limpa cache do Psalm
	@echo "$(YELLOW)üßπ Limpando cache do Psalm...$(NC)"
	docker compose exec php ./vendor/bin/psalm --clear-cache || true


##@ üîß An√°lise de Complexidade

complexity-check: ## Verifica complexidade ciclom√°tica
	@echo "$(GREEN)üîç Verificando complexidade do c√≥digo...$(NC)"
	@if command -v phploc > /dev/null 2>&1 || docker compose exec php composer show | grep -q phploc; then \
		docker compose exec php ./vendor/bin/phploc backend/app || true; \
	else \
		echo "$(YELLOW)üí° Instale phploc: make composer-require-dev package=phploc/phploc$(NC)"; \
	fi

phploc-install: ## Instala phploc (an√°lise de m√©tricas)
	@echo "$(GREEN)üì¶ Instalando phploc...$(NC)"
	docker compose exec php composer require --dev phploc/phploc
	@echo "$(GREEN)‚úÖ phploc instalado!$(NC)"

phploc-analyze: ## Analisa m√©tricas do c√≥digo
	@echo "$(GREEN)üìä Analisando m√©tricas com phploc...$(NC)"
	docker compose exec php ./vendor/bin/phploc backend/app || true


##@ üõ†Ô∏è Verifica√ß√£o de Depend√™ncias

composer-audit: ## Verifica vulnerabilidades (Composer)
	@echo "$(GREEN)üîí Verificando vulnerabilidades...$(NC)"
	docker compose exec php composer audit

composer-audit-format: ## Auditoria em formato JSON
	@echo "$(GREEN)üîí Verificando vulnerabilidades (JSON)...$(NC)"
	docker compose exec php composer audit --format=json || true


##@ üéØ Workflow Completo de Qualidade

quality-check: ## Executa todas as verifica√ß√µes de qualidade
	@echo "$(BLUE)‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ$(NC)"
	@echo "$(GREEN)üîç Verifica√ß√£o Completa de Qualidade$(NC)"
	@echo "$(BLUE)‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ$(NC)"
	@echo ""
	@echo "$(YELLOW)1/5 Executando testes...$(NC)"
	$(MAKE) test || echo "$(YELLOW)‚ö†Ô∏è  Testes n√£o passaram$(NC)"
	@echo ""
	@echo "$(YELLOW)2/5 Verificando estilo de c√≥digo...$(NC)"
	$(MAKE) phpcs-check || echo "$(YELLOW)‚ö†Ô∏è  PHP CS Fixer n√£o configurado$(NC)"
	@echo ""
	@echo "$(YELLOW)3/5 Analisando com PHPStan...$(NC)"
	$(MAKE) phpstan-analyze || echo "$(YELLOW)‚ö†Ô∏è  PHPStan n√£o configurado$(NC)"
	@echo ""
	@echo "$(YELLOW)4/5 Verificando vulnerabilidades...$(NC)"
	$(MAKE) composer-audit || echo "$(YELLOW)‚ö†Ô∏è  Auditoria n√£o dispon√≠vel$(NC)"
	@echo ""
	@echo "$(YELLOW)5/5 Gerando m√©tricas...$(NC)"
	$(MAKE) phploc-analyze || echo "$(YELLOW)‚ö†Ô∏è  phploc n√£o configurado$(NC)"
	@echo ""
	@echo "$(GREEN)‚úÖ Verifica√ß√£o de qualidade conclu√≠da!$(NC)"

quality-fix: ## Corrige automaticamente problemas de qualidade
	@echo "$(BLUE)‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ$(NC)"
	@echo "$(GREEN)üîß Corre√ß√£o Autom√°tica de Qualidade$(NC)"
	@echo "$(BLUE)‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ$(NC)"
	@echo ""
	@echo "$(YELLOW)1/3 Corrigindo estilo com PHP CS Fixer...$(NC)"
	$(MAKE) phpcs-fix || echo "$(YELLOW)‚ö†Ô∏è  PHP CS Fixer n√£o configurado$(NC)"
	@echo ""
	@echo "$(YELLOW)2/3 Corrigindo com PHP Insights...$(NC)"
	$(MAKE) phpinsights-fix || echo "$(YELLOW)‚ö†Ô∏è  PHP Insights n√£o configurado$(NC)"
	@echo ""
	@echo "$(YELLOW)3/3 Formatando com Laravel Pint...$(NC)"
	$(MAKE) pint-fix || echo "$(YELLOW)‚ö†Ô∏è  Laravel Pint n√£o configurado$(NC)"
	@echo ""
	@echo "$(GREEN)‚úÖ Corre√ß√£o autom√°tica conclu√≠da!$(NC)"

quality-install-all: ## Instala todas as ferramentas de qualidade
	@echo "$(BLUE)‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ$(NC)"
	@echo "$(GREEN)üì¶ Instalando Todas as Ferramentas de Qualidade$(NC)"
	@echo "$(BLUE)‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ$(NC)"
	@echo ""
	@echo "$(YELLOW)Instalando PHP Insights...$(NC)"
	$(MAKE) phpinsights-install || true
	@echo ""
	@echo "$(YELLOW)Instalando PHPStan...$(NC)"
	$(MAKE) phpstan-install || true
	@echo ""
	@echo "$(YELLOW)Instalando PHP CS Fixer...$(NC)"
	$(MAKE) phpcs-install || true
	@echo ""
	@echo "$(YELLOW)Instalando Laravel Pint...$(NC)"
	$(MAKE) pint-install || true
	@echo ""
	@echo "$(YELLOW)Instalando PHPMD...$(NC)"
	$(MAKE) phpmd-install || true
	@echo ""
	@echo "$(YELLOW)Instalando phploc...$(NC)"
	$(MAKE) phploc-install || true
	@echo ""
	@echo "$(GREEN)‚úÖ Instala√ß√£o conclu√≠da!$(NC)"
	@echo "$(YELLOW)üí° Execute: make quality-check$(NC)"


##@ üìä M√©tricas e Relat√≥rios

code-metrics: ## Mostra m√©tricas gerais do c√≥digo
	@echo "$(BLUE)‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ$(NC)"
	@echo "$(GREEN)üìä M√©tricas do C√≥digo$(NC)"
	@echo "$(BLUE)‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ$(NC)"
	@echo ""
	@echo "$(YELLOW)üìÅ Arquivos PHP:$(NC)"
	@find backend/app -name "*.php" 2>/dev/null | wc -l || echo "0"
	@echo ""
	@echo "$(YELLOW)üìù Linhas de c√≥digo (estimado):$(NC)"
	@find backend/app -name "*.php" -exec cat {} \; 2>/dev/null | wc -l || echo "0"
	@echo ""
	@echo "$(YELLOW)üß™ Testes:$(NC)"
	@find backend/tests -name "*.php" 2>/dev/null | wc -l || echo "0"
	@echo ""
	@if docker compose exec php composer show | grep -q phploc; then \
		echo "$(YELLOW)üìä An√°lise detalhada:$(NC)"; \
		docker compose exec php ./vendor/bin/phploc backend/app || true; \
	fi


##@ üìö Documenta√ß√£o - PHPDoc

phpdoc-install: ## Instala phpDocumentor
	@echo "$(GREEN)üì¶ Instalando phpDocumentor...$(NC)"
	docker compose exec php composer require --dev phpdocumentor/phpdocumentor
	@echo "$(GREEN)‚úÖ phpDocumentor instalado!$(NC)"

phpdoc-generate: ## Gera documenta√ß√£o PHPDoc
	@echo "$(GREEN)üìö Gerando documenta√ß√£o PHPDoc...$(NC)"
	@mkdir -p docs/api
	docker compose exec php ./vendor/bin/phpdoc -d backend/app -t docs/api --title="API Documentation" || true

phpdoc-generate-custom: ## Gera documenta√ß√£o com configura√ß√£o customizada
	@read -p "Diret√≥rio de sa√≠da (ex: docs/api): " dir; \
	mkdir -p $$dir; \
	echo "$(GREEN)üìö Gerando documenta√ß√£o em $$dir...$(NC)"; \
	docker compose exec php ./vendor/bin/phpdoc -d backend/app -t $$dir --title="API Documentation" || true


##@ üìö Documenta√ß√£o - API Documentation Generator

api-docs-install: ## Instala Laravel API Documentation Generator
	@echo "$(GREEN)üì¶ Instalando Laravel API Documentation Generator...$(NC)"
	docker compose exec php composer require --dev mpociot/laravel-apidoc-generator || \
	docker compose exec php composer require --dev darkaonline/l5-swagger || \
	echo "$(YELLOW)‚ö†Ô∏è  Escolha uma ferramenta: mpociot/laravel-apidoc-generator ou darkaonline/l5-swagger$(NC)"

api-docs-generate: ## Gera documenta√ß√£o da API
	@echo "$(GREEN)üìö Gerando documenta√ß√£o da API...$(NC)"
	@if docker compose exec php composer show | grep -q "mpociot/laravel-apidoc-generator"; then \
		docker compose exec php php artisan api:generate || true; \
	elif docker compose exec php composer show | grep -q "darkaonline/l5-swagger"; then \
		docker compose exec php php artisan l5-swagger:generate || true; \
	else \
		echo "$(YELLOW)‚ö†Ô∏è  Nenhuma ferramenta de documenta√ß√£o instalada$(NC)"; \
		echo "$(YELLOW)üí° Execute: make api-docs-install$(NC)"; \
	fi


##@ üìö Documenta√ß√£o - Scribe

scribe-install: ## Instala Scribe (documenta√ß√£o de API)
	@echo "$(GREEN)üì¶ Instalando Scribe...$(NC)"
	docker compose exec php composer require --dev knuckleswtf/scribe
	@echo "$(GREEN)‚úÖ Scribe instalado!$(NC)"
	@echo "$(YELLOW)üí° Execute: make scribe-generate$(NC)"

scribe-generate: ## Gera documenta√ß√£o com Scribe
	@echo "$(GREEN)üìö Gerando documenta√ß√£o com Scribe...$(NC)"
	docker compose exec php php artisan scribe:generate || true

scribe-publish: ## Publica configura√ß√£o do Scribe
	@echo "$(GREEN)‚öôÔ∏è  Publicando configura√ß√£o do Scribe...$(NC)"
	docker compose exec php php artisan vendor:publish --tag=scribe-config || true


##@ üìù Documenta√ß√£o - Scramble (API Documentation)

scramble-install: ## Instala Scramble (gerador de documenta√ß√£o OpenAPI)
	@echo "$(GREEN)üì¶ Instalando Scramble...$(NC)"
	docker compose exec php composer require --dev dedoc/scramble
	@echo "$(GREEN)‚úÖ Scramble instalado!$(NC)"
	@echo "$(YELLOW)üí° Execute: make scramble-publish$(NC)"

scramble-publish: ## Publica configura√ß√£o do Scramble
	@echo "$(GREEN)‚öôÔ∏è  Publicando configura√ß√£o do Scramble...$(NC)"
	docker compose exec php php artisan vendor:publish --tag=scramble-config || true

scramble-generate: ## Gera documenta√ß√£o OpenAPI/Swagger
	@echo "$(GREEN)üìö Gerando documenta√ß√£o OpenAPI com Scramble...$(NC)"
	@echo "$(YELLOW)üí° Acesse: http://localhost:8080/api/docs para ver a documenta√ß√£o$(NC)"
	@echo "$(YELLOW)üí° Ou gere o arquivo JSON: make scramble-generate-json$(NC)"

scramble-generate-json: ## Gera arquivo OpenAPI JSON
	@read -p "Nome do arquivo (ex: openapi.json): " file; \
	file=$${file:-openapi.json}; \
	echo "$(GREEN)üìö Gerando $$file...$(NC)"; \
	docker compose exec php php artisan scramble:export --output=$$file || true

scramble-generate-yaml: ## Gera arquivo OpenAPI YAML
	@read -p "Nome do arquivo (ex: openapi.yaml): " file; \
	file=$${file:-openapi.yaml}; \
	echo "$(GREEN)üìö Gerando $$file...$(NC)"; \
	docker compose exec php php artisan scramble:export --output=$$file --format=yaml || true


##@ üìù Documenta√ß√£o - Swagger (L5-Swagger)

swagger-install: ## Instala L5-Swagger (Swagger UI para Laravel)
	@echo "$(GREEN)üì¶ Instalando L5-Swagger...$(NC)"
	docker compose exec php composer require --dev darkaonline/l5-swagger
	@echo "$(GREEN)‚úÖ L5-Swagger instalado!$(NC)"
	@echo "$(YELLOW)üí° Execute: make swagger-publish$(NC)"

swagger-publish: ## Publica configura√ß√£o do Swagger
	@echo "$(GREEN)‚öôÔ∏è  Publicando configura√ß√£o do Swagger...$(NC)"
	docker compose exec php php artisan vendor:publish --provider "L5Swagger\L5SwaggerServiceProvider" || true

swagger-generate: ## Gera documenta√ß√£o Swagger
	@echo "$(GREEN)üìö Gerando documenta√ß√£o Swagger...$(NC)"
	docker compose exec php php artisan l5-swagger:generate || true
	@echo "$(GREEN)‚úÖ Documenta√ß√£o gerada!$(NC)"
	@echo "$(YELLOW)üí° Acesse: http://localhost:8080/api/documentation$(NC)"

swagger-ui: ## Abre Swagger UI no navegador
	@echo "$(GREEN)üåê Abrindo Swagger UI...$(NC)"
	@xdg-open http://localhost:8080/api/documentation 2>/dev/null || \
	 open http://localhost:8080/api/documentation 2>/dev/null || \
	 echo "$(YELLOW)üí° Acesse: http://localhost:8080/api/documentation$(NC)"

swagger-config: ## Mostra configura√ß√£o atual do Swagger
	@echo "$(GREEN)‚öôÔ∏è  Configura√ß√£o do Swagger:$(NC)"
	@if [ -f "backend/config/l5-swagger.php" ]; then \
		cat backend/config/l5-swagger.php | grep -A 5 "routes" || true; \
	else \
		echo "$(YELLOW)‚ö†Ô∏è  Arquivo de configura√ß√£o n√£o encontrado$(NC)"; \
		echo "$(YELLOW)üí° Execute: make swagger-publish$(NC)"; \
	fi

