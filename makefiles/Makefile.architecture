##@ ğŸ—ï¸  Arquitetura AvanÃ§ada (PadrÃµes)

setup-architecture: ## Cria estrutura completa de pastas (Services, Repositories, Actions, etc)
	@echo "$(BLUE)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "$(GREEN)  ğŸ—ï¸  Configurando Estrutura de Arquitetura Laravel$(NC)"
	@echo "$(BLUE)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo ""
	@echo "$(YELLOW)ğŸ“‹ Estrutura de Camadas:$(NC)"
	@echo ""
	@echo "$(CYAN)  app/Http/          $(NC)â†’ Camada de Transporte (Controllers, Middleware, Requests)"
	@echo "$(CYAN)  app/Services/      $(NC)â†’ Camada de NegÃ³cio (Regras de negÃ³cio complexas)"
	@echo "$(CYAN)  app/Repositories/  $(NC)â†’ Camada de Dados (Acesso a Models)"
	@echo "$(CYAN)  app/Models/        $(NC)â†’ Camada de PersistÃªncia (Eloquent)"
	@echo "$(CYAN)  app/Actions/       $(NC)â†’ AÃ§Ãµes de Uso Ãšnico (Comandos testÃ¡veis)"
	@echo "$(CYAN)  app/Enums/         $(NC)â†’ Constantes Tipadas (Status, Tipos)"
	@echo "$(CYAN)  app/Observers/     $(NC)â†’ Listeners de Eventos de Model"
	@echo "$(CYAN)  app/Utils/         $(NC)â†’ UtilitÃ¡rios GenÃ©ricos (Helpers)"
	@echo "$(CYAN)  app/Traits/        $(NC)â†’ CÃ³digo ReutilizÃ¡vel (Traits PHP)"
	@echo ""
	@echo "$(YELLOW)ğŸ”¨ Criando estrutura...$(NC)"
	@echo ""
	@mkdir -p backups 2>/dev/null || true
	@docker compose exec php bash -c ' \
		GREEN="\033[0;32m"; \
		YELLOW="\033[1;33m"; \
		NC="\033[0m"; \
		created=(); \
		existed=(); \
		dirs=( \
			"backend/app/Services" \
			"backend/app/Repositories" \
			"backend/app/Repositories/Contracts" \
			"backend/app/Actions" \
			"backend/app/Enums" \
			"backend/app/Observers" \
			"backend/app/Utils" \
			"backend/app/Traits" \
			"backend/app/DTOs" \
		); \
		for dir in "$${dirs[@]}"; do \
			if [ ! -d "$$dir" ]; then \
				mkdir -p "$$dir"; \
				touch "$$dir/.gitkeep"; \
				created+=("$$dir"); \
			else \
				existed+=("$$dir"); \
			fi; \
		done; \
		if [ $${#created[@]} -gt 0 ]; then \
			echo "âœ… Criadas ($${#created[@]}):" ; \
			for dir in "$${created[@]}"; do \
				echo -e "   $${GREEN}+ $$dir$${NC}"; \
			done; \
		fi; \
		if [ $${#existed[@]} -gt 0 ]; then \
			echo ""; \
			echo "â„¹ï¸  JÃ¡ existiam ($${#existed[@]}):" ; \
			for dir in "$${existed[@]}"; do \
				echo -e "   $${YELLOW}âœ“ $$dir$${NC}"; \
			done; \
		fi; \
	' || true
	@echo ""
	@echo "$(BLUE)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "$(GREEN)  âœ… Estrutura de Arquitetura Configurada!$(NC)"
	@echo "$(BLUE)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo ""
	@echo "$(YELLOW)ğŸ“š Comandos disponÃ­veis para criar componentes:$(NC)"
	@echo ""
	@echo "  $(CYAN)make make-service$(NC)           â†’ Criar Service"
	@echo "  $(CYAN)make make-repository$(NC)        â†’ Criar Repository + Interface"
	@echo "  $(CYAN)make make-action$(NC)            â†’ Criar Action"
	@echo "  $(CYAN)make make-dto$(NC)               â†’ Criar DTO"
	@echo "  $(CYAN)make make-observable-model$(NC)  â†’ Criar Model com Observer"
	@echo ""
	@echo "$(GREEN)ğŸ’¡ Use 'make help' para ver todos os comandos disponÃ­veis$(NC)"
	@echo ""

make-repository: ## Cria repository pattern (Repository + Interface)
	@read -p "Nome do repository (ex: UserRepository): " name; \
	if [ -z "$$name" ]; then \
		echo "$(RED)âŒ Nome Ã© obrigatÃ³rio!$(NC)"; \
	else \
		echo "$(GREEN)ğŸ“ Criando repository $$name...$(NC)"; \
		docker compose exec php mkdir -p app/Repositories/Contracts; \
		docker compose exec php mkdir -p app/Repositories; \
		interface_name="$$(echo $$name | sed 's/Repository//')RepositoryInterface"; \
		echo "$(YELLOW)Criando interface $$interface_name...$(NC)"; \
		docker compose exec php bash -c "echo '<?php' > app/Repositories/Contracts/$$interface_name.php"; \
		docker compose exec php bash -c "echo '' >> app/Repositories/Contracts/$$interface_name.php"; \
		docker compose exec php bash -c "echo 'namespace App\\\Repositories\\\Contracts;' >> app/Repositories/Contracts/$$interface_name.php"; \
		docker compose exec php bash -c "echo '' >> app/Repositories/Contracts/$$interface_name.php"; \
		docker compose exec php bash -c "echo 'interface $$interface_name' >> app/Repositories/Contracts/$$interface_name.php"; \
		docker compose exec php bash -c "echo '{' >> app/Repositories/Contracts/$$interface_name.php"; \
		docker compose exec php bash -c "echo '    // Define repository methods' >> app/Repositories/Contracts/$$interface_name.php"; \
		docker compose exec php bash -c "echo '}' >> app/Repositories/Contracts/$$interface_name.php"; \
		echo "$(YELLOW)Criando repository $$name...$(NC)"; \
		docker compose exec php bash -c "echo '<?php' > app/Repositories/$$name.php"; \
		docker compose exec php bash -c "echo '' >> app/Repositories/$$name.php"; \
		docker compose exec php bash -c "echo 'namespace App\\\Repositories;' >> app/Repositories/$$name.php"; \
		docker compose exec php bash -c "echo '' >> app/Repositories/$$name.php"; \
		docker compose exec php bash -c "echo 'use App\\\Repositories\\\Contracts\\\$$interface_name;' >> app/Repositories/$$name.php"; \
		docker compose exec php bash -c "echo '' >> app/Repositories/$$name.php"; \
		docker compose exec php bash -c "echo 'class $$name implements $$interface_name' >> app/Repositories/$$name.php"; \
		docker compose exec php bash -c "echo '{' >> app/Repositories/$$name.php"; \
		docker compose exec php bash -c "echo '    // Implement repository methods' >> app/Repositories/$$name.php"; \
		docker compose exec php bash -c "echo '}' >> app/Repositories/$$name.php"; \
		echo "$(GREEN)âœ… Repository $$name e Interface $$interface_name criados!$(NC)"; \
	fi

make-service: ## Cria service pattern (Service class)
	@read -p "Nome do service (ex: UserService): " name; \
	if [ -z "$$name" ]; then \
		echo "$(RED)âŒ Nome Ã© obrigatÃ³rio!$(NC)"; \
	else \
		echo "$(GREEN)ğŸ“ Criando service $$name...$(NC)"; \
		docker compose exec php mkdir -p app/Services; \
		docker compose exec php php artisan make:class "Services/$$name"; \
		docker compose exec php bash -c "echo '<?php' > app/Services/$$name.php"; \
		docker compose exec php bash -c "echo '' >> app/Services/$$name.php"; \
		docker compose exec php bash -c "echo 'namespace App\\\Services;' >> app/Services/$$name.php"; \
		docker compose exec php bash -c "echo '' >> app/Services/$$name.php"; \
		docker compose exec php bash -c "echo 'class $$name' >> app/Services/$$name.php"; \
		docker compose exec php bash -c "echo '{' >> app/Services/$$name.php"; \
		docker compose exec php bash -c "echo '    // Service logic' >> app/Services/$$name.php"; \
		docker compose exec php bash -c "echo '}' >> app/Services/$$name.php"; \
		echo "$(GREEN)âœ… Service $$name criado em app/Services/$(NC)"; \
	fi

make-action: ## Cria action class (Single Responsibility)
	@read -p "Nome da action (ex: CreateUserAction): " name; \
	if [ -z "$$name" ]; then \
		echo "$(RED)âŒ Nome Ã© obrigatÃ³rio!$(NC)"; \
	else \
		echo "$(GREEN)ğŸ“ Criando action $$name...$(NC)"; \
		docker compose exec php mkdir -p app/Actions; \
		docker compose exec php bash -c "echo '<?php' > app/Actions/$$name.php"; \
		docker compose exec php bash -c "echo '' >> app/Actions/$$name.php"; \
		docker compose exec php bash -c "echo 'namespace App\\\Actions;' >> app/Actions/$$name.php"; \
		docker compose exec php bash -c "echo '' >> app/Actions/$$name.php"; \
		docker compose exec php bash -c "echo 'class $$name' >> app/Actions/$$name.php"; \
		docker compose exec php bash -c "echo '{' >> app/Actions/$$name.php"; \
		docker compose exec php bash -c "echo '    public function execute(array \$$data)' >> app/Actions/$$name.php"; \
		docker compose exec php bash -c "echo '    {' >> app/Actions/$$name.php"; \
		docker compose exec php bash -c "echo '        // Action logic' >> app/Actions/$$name.php"; \
		docker compose exec php bash -c "echo '    }' >> app/Actions/$$name.php"; \
		docker compose exec php bash -c "echo '}' >> app/Actions/$$name.php"; \
		echo "$(GREEN)âœ… Action $$name criada em app/Actions/$(NC)"; \
	fi

make-dto: ## Cria DTO (Data Transfer Object)
	@read -p "Nome do DTO (ex: UserDTO): " name; \
	if [ -z "$$name" ]; then \
		echo "$(RED)âŒ Nome Ã© obrigatÃ³rio!$(NC)"; \
	else \
		echo "$(GREEN)ğŸ“ Criando DTO $$name...$(NC)"; \
		docker compose exec php mkdir -p app/DTOs; \
		docker compose exec php bash -c "echo '<?php' > app/DTOs/$$name.php"; \
		docker compose exec php bash -c "echo '' >> app/DTOs/$$name.php"; \
		docker compose exec php bash -c "echo 'namespace App\\\DTOs;' >> app/DTOs/$$name.php"; \
		docker compose exec php bash -c "echo '' >> app/DTOs/$$name.php"; \
		docker compose exec php bash -c "echo 'class $$name' >> app/DTOs/$$name.php"; \
		docker compose exec php bash -c "echo '{' >> app/DTOs/$$name.php"; \
		docker compose exec php bash -c "echo '    public function __construct(' >> app/DTOs/$$name.php"; \
		docker compose exec php bash -c "echo '        // Add properties' >> app/DTOs/$$name.php"; \
		docker compose exec php bash -c "echo '    ) {' >> app/DTOs/$$name.php"; \
		docker compose exec php bash -c "echo '        // Constructor' >> app/DTOs/$$name.php"; \
		docker compose exec php bash -c "echo '    }' >> app/DTOs/$$name.php"; \
		docker compose exec php bash -c "echo '' >> app/DTOs/$$name.php"; \
		docker compose exec php bash -c "echo '    public function toArray(): array' >> app/DTOs/$$name.php"; \
		docker compose exec php bash -c "echo '    {' >> app/DTOs/$$name.php"; \
		docker compose exec php bash -c "echo '        return [' >> app/DTOs/$$name.php"; \
		docker compose exec php bash -c "echo '            // Return array representation' >> app/DTOs/$$name.php"; \
		docker compose exec php bash -c "echo '        ];' >> app/DTOs/$$name.php"; \
		docker compose exec php bash -c "echo '    }' >> app/DTOs/$$name.php"; \
		docker compose exec php bash -c "echo '}' >> app/DTOs/$$name.php"; \
		echo "$(GREEN)âœ… DTO $$name criado em app/DTOs/$(NC)"; \
	fi

make-resource-collection: ## Cria resource collection
	@read -p "Nome da collection (ex: UserCollection): " name; \
	if [ -z "$$name" ]; then \
		echo "$(RED)âŒ Nome Ã© obrigatÃ³rio!$(NC)"; \
	else \
		echo "$(GREEN)ğŸ“ Criando resource collection $$name...$(NC)"; \
		docker compose exec php php artisan make:resource $$name --collection; \
		echo "$(GREEN)âœ… Resource collection $$name criada!$(NC)"; \
	fi

make-resource-full: ## Cria resource completo (single + collection)
	@read -p "Nome do resource (ex: UserResource): " name; \
	if [ -z "$$name" ]; then \
		echo "$(RED)âŒ Nome Ã© obrigatÃ³rio!$(NC)"; \
	else \
		echo "$(GREEN)ğŸ“ Criando resource completo $$name...$(NC)"; \
		docker compose exec php php artisan make:resource $$name; \
		docker compose exec php php artisan make:resource $$name --collection; \
		echo "$(GREEN)âœ… Resource completo $$name criado!$(NC)"; \
	fi

make-form-request-update: ## Cria form request para update
	@read -p "Nome do request (ex: UpdateUserRequest): " name; \
	if [ -z "$$name" ]; then \
		echo "$(RED)âŒ Nome Ã© obrigatÃ³rio!$(NC)"; \
	else \
		echo "$(GREEN)ğŸ“ Criando form request $$name...$(NC)"; \
		docker compose exec php php artisan make:request $$name; \
		echo "$(GREEN)âœ… Form request $$name criado!$(NC)"; \
	fi

make-api-resource-full: ## Cria API resource completo (model + controller + resource + request)
	@read -p "Nome do resource (ex: Post): " name; \
	if [ -z "$$name" ]; then \
		echo "$(RED)âŒ Nome Ã© obrigatÃ³rio!$(NC)"; \
	else \
		echo "$(GREEN)ğŸ“ Criando API completa para $$name...$(NC)"; \
		docker compose exec php php artisan make:model $$name -mfsc; \
		docker compose exec php php artisan make:controller $$name"Controller" --api; \
		docker compose exec php php artisan make:resource $$name"Resource"; \
		docker compose exec php php artisan make:resource $$name"Resource" --collection; \
		docker compose exec php php artisan make:request Store$$name"Request"; \
		docker compose exec php php artisan make:request Update$$name"Request"; \
		echo "$(GREEN)âœ… API completa criada para $$name!$(NC)"; \
		echo "$(YELLOW)Arquivos criados:$(NC)"; \
		echo "  - Model: app/Models/$$name.php"; \
		echo "  - Migration: database/migrations/xxx_create_$$(echo $$name | tr '[:upper:]' '[:lower:]')s_table.php"; \
		echo "  - Factory: database/factories/$$name"Factory.php"; \
		echo "  - Seeder: database/seeders/$$name"Seeder.php"; \
		echo "  - Controller: app/Http/Controllers/$$name"Controller.php"; \
		echo "  - Resource: app/Http/Resources/$$name"Resource.php"; \
		echo "  - Collection: app/Http/Resources/$$name"ResourceCollection.php"; \
		echo "  - StoreRequest: app/Http/Requests/Store$$name"Request.php"; \
		echo "  - UpdateRequest: app/Http/Requests/Update$$name"Request.php"; \
	fi

make-module: ## Cria estrutura de mÃ³dulo (Module pattern)
	@read -p "Nome do mÃ³dulo (ex: Blog): " name; \
	if [ -z "$$name" ]; then \
		echo "$(RED)âŒ Nome Ã© obrigatÃ³rio!$(NC)"; \
	else \
		echo "$(GREEN)ğŸ“ Criando mÃ³dulo $$name...$(NC)"; \
		docker compose exec php mkdir -p app/Modules/$$name/{Controllers,Models,Requests,Resources,Services,Repositories}; \
		docker compose exec php php artisan make:model "Modules/$$name/Models/$$name"; \
		docker compose exec php php artisan make:controller "Modules/$$name/Controllers/$$name"Controller --api; \
		docker compose exec php php artisan make:resource "Modules/$$name/Resources/$$name"Resource; \
		echo "$(GREEN)âœ… MÃ³dulo $$name criado em app/Modules/$$name/$(NC)"; \
	fi

make-event-listener-full: ## Cria event + listener completo
	@read -p "Nome do event (ex: UserCreated): " name; \
	if [ -z "$$name" ]; then \
		echo "$(RED)âŒ Nome Ã© obrigatÃ³rio!$(NC)"; \
	else \
		echo "$(GREEN)ğŸ“ Criando event + listener $$name...$(NC)"; \
		docker compose exec php php artisan make:event $$name; \
		listener_name="$$(echo $$name | sed 's/Event//')Listener"; \
		docker compose exec php php artisan make:listener $$listener_name --event=$$name; \
		echo "$(GREEN)âœ… Event $$name e Listener $$listener_name criados!$(NC)"; \
	fi

make-queue-job-full: ## Cria job com queue completo
	@read -p "Nome do job (ex: SendEmailJob): " name; \
	if [ -z "$$name" ]; then \
		echo "$(RED)âŒ Nome Ã© obrigatÃ³rio!$(NC)"; \
	else \
		echo "$(GREEN)ğŸ“ Criando job $$name...$(NC)"; \
		docker compose exec php php artisan make:job $$name --queued; \
		echo "$(GREEN)âœ… Job $$name criado com suporte a queue!$(NC)"; \
	fi

make-policy-model: ## Cria policy para um model
	@read -p "Nome do model (ex: Post): " name; \
	if [ -z "$$name" ]; then \
		echo "$(RED)âŒ Nome Ã© obrigatÃ³rio!$(NC)"; \
	else \
		echo "$(GREEN)ğŸ“ Criando policy para $$name...$(NC)"; \
		docker compose exec php php artisan make:policy $$name"Policy" --model=$$name; \
		echo "$(GREEN)âœ… Policy $$name"Policy criada!$(NC)"; \
	fi

make-observable-model: ## Cria model com observer
	@read -p "Nome do model (ex: User): " name; \
	if [ -z "$$name" ]; then \
		echo "$(RED)âŒ Nome Ã© obrigatÃ³rio!$(NC)"; \
	else \
		echo "$(GREEN)ğŸ“ Criando model $$name com observer...$(NC)"; \
		docker compose exec php php artisan make:model $$name -m; \
		observer_name="$$name"Observer; \
		docker compose exec php php artisan make:observer $$observer_name --model=$$name; \
		echo "$(GREEN)âœ… Model $$name e Observer $$observer_name criados!$(NC)"; \
	fi

