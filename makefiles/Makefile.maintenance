##@ ðŸ§¹ Cache & OtimizaÃ§Ã£o

cache-clear: ## Limpa cache da aplicaÃ§Ã£o
	docker compose exec php php artisan cache:clear

cache-forget: ## Remove item especÃ­fico do cache
	@read -p "Chave do cache: " key; \
	docker compose exec php php artisan cache:forget $$key

cache-prune-tags: ## Remove tags stale do cache (Redis)
	docker compose exec php php artisan cache:prune-stale-tags

config-clear: ## Limpa cache de configuraÃ§Ã£o
	docker compose exec php php artisan config:clear

config-publish: ## Publica arquivos de configuraÃ§Ã£o
	docker compose exec php php artisan config:publish

route-clear: ## Limpa cache de rotas
	docker compose exec php php artisan route:clear

view-clear: ## Limpa cache de views
	docker compose exec php php artisan view:clear

event-clear: ## Limpa cache de eventos
	docker compose exec php php artisan event:clear

event-list: ## Lista eventos e listeners
	docker compose exec php php artisan event:list

clear-compiled: ## Remove arquivo de classe compilada
	docker compose exec php php artisan clear-compiled

clear-all: ## Limpa TODOS os caches
	@echo "$(GREEN)ðŸ§¹ Limpando todos os caches...$(NC)"
	docker compose exec php php artisan optimize:clear
	docker compose exec php php artisan cache:clear
	docker compose exec php php artisan config:clear
	docker compose exec php php artisan route:clear
	docker compose exec php php artisan view:clear
	docker compose exec php php artisan event:clear
	@echo "$(GREEN)âœ… Todos os caches limpos!$(NC)"

optimize: ## Otimiza aplicaÃ§Ã£o (produÃ§Ã£o)
	@echo "$(GREEN)âš¡ Otimizando aplicaÃ§Ã£o...$(NC)"
	docker compose exec php php artisan optimize

optimize-clear: ## Remove todas otimizaÃ§Ãµes
	docker compose exec php php artisan optimize:clear

config-cache: ## Cria cache de configuraÃ§Ã£o
	docker compose exec php php artisan config:cache

route-cache: ## Cria cache de rotas
	docker compose exec php php artisan route:cache

event-cache: ## Cria cache de eventos
	docker compose exec php php artisan event:cache

production-ready: ## Prepara app para produÃ§Ã£o
	@echo "$(GREEN)ðŸš€ Preparando para produÃ§Ã£o...$(NC)"
	docker compose exec php php artisan config:cache
	docker compose exec php php artisan route:cache
	docker compose exec php php artisan view:cache
	docker compose exec php php artisan event:cache
	docker compose exec php php artisan optimize
	@echo "$(GREEN)âœ… AplicaÃ§Ã£o otimizada para produÃ§Ã£o!$(NC)"


##@ ðŸ”‘ Chaves & SeguranÃ§a

key-generate: ## Gera nova chave da aplicaÃ§Ã£o
	docker compose exec php php artisan key:generate

storage-link: ## Cria link simbÃ³lico de storage
	docker compose exec php php artisan storage:link

storage-unlink: ## Remove link simbÃ³lico de storage
	docker compose exec php php artisan storage:unlink

permissions: ## Corrige permissÃµes do Laravel
	@echo "$(YELLOW)ðŸ” Corrigindo permissÃµes...$(NC)"
	docker compose exec php chmod -R 775 storage bootstrap/cache
	docker compose exec php chown -R www-data:www-data storage bootstrap/cache
	@echo "$(GREEN)âœ… PermissÃµes corrigidas!$(NC)"


##@ ðŸ“Š Logs & Monitoramento

logs-laravel: ## Tail logs do Laravel
	docker compose exec php tail -f storage/logs/laravel.log

pail: ## Tail logs usando Pail (Laravel 12+)
	docker compose exec php php artisan pail

logs-laravel-clear: ## Limpa logs do Laravel
	docker compose exec php sh -c "> storage/logs/laravel.log"
	@echo "$(GREEN)âœ… Logs limpos!$(NC)"

logs-mysql-error: ## Mostra error log do MySQL
	docker compose exec mysql tail -f /var/log/mysql/error.log

logs-mysql-general: ## Mostra general log do MySQL
	docker compose exec mysql tail -f /var/lib/mysql/general.log

logs-nginx-access: ## Mostra access log do Nginx
	docker compose exec nginx tail -f /var/log/nginx/access.log

logs-nginx-error: ## Mostra error log do Nginx
	docker compose exec nginx tail -f /var/log/nginx/error.log


##@ ðŸ”§ ManutenÃ§Ã£o

maintenance-on: ## Ativa modo de manutenÃ§Ã£o
	@echo "$(YELLOW)ðŸš§ Ativando modo de manutenÃ§Ã£o...$(NC)"
	docker compose exec php php artisan down
	@echo "$(GREEN)âœ… Modo de manutenÃ§Ã£o ativado!$(NC)"

maintenance-off: ## Desativa modo de manutenÃ§Ã£o
	@echo "$(GREEN)âœ… Desativando modo de manutenÃ§Ã£o...$(NC)"
	docker compose exec php php artisan up
	@echo "$(GREEN)âœ… AplicaÃ§Ã£o disponÃ­vel novamente!$(NC)"

maintenance-secret: ## Ativa manutenÃ§Ã£o com secret
	@read -p "Secret (token para bypass): " secret; \
	docker compose exec php php artisan down --secret=$$secret && \
	echo "$(GREEN)Acesse com: ?secret=$$secret$(NC)"


##@ ðŸ“ˆ Status & Health

status: ## Mostra status completo do ambiente
	@echo "$(BLUE)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "$(GREEN)ðŸ“Š Status do Ambiente Laravel$(NC)"
	@echo "$(BLUE)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo ""
	@echo "$(YELLOW)ðŸ³ Containers:$(NC)"
	@docker compose ps
	@echo ""
	@echo "$(YELLOW)ðŸ“¦ AplicaÃ§Ã£o:$(NC)"
	@docker compose exec php php artisan about
	@echo ""
	@echo "$(YELLOW)ðŸ—„ï¸  Migrations:$(NC)"
	@docker compose exec php php artisan migrate:status

health: ## Check de saÃºde completo
	@echo "$(GREEN)ðŸ¥ Health Check...$(NC)"
	@echo ""
	@echo "$(YELLOW)Testando MySQL...$(NC)"
	@docker compose exec mysql mysqladmin -u root -proot ping 2>/dev/null && echo "$(GREEN)âœ“ MySQL OK$(NC)" || echo "$(YELLOW)âš  MySQL nÃ£o estÃ¡ rodando$(NC)"
	@echo ""
	@echo "$(YELLOW)Testando Redis...$(NC)"
	@docker compose exec redis redis-cli ping 2>/dev/null && echo "$(GREEN)âœ“ Redis OK$(NC)" || echo "$(RED)âŒ Redis com problema$(NC)"
	@echo ""
	@echo "$(YELLOW)Testando PHP-FPM...$(NC)"
	@docker compose exec php php -v | head -1 || echo "$(RED)âŒ PHP com problema$(NC)"
	@echo ""
	@echo "$(GREEN)âœ… Health check concluÃ­do!$(NC)"

info: ## Mostra informaÃ§Ãµes do ambiente
	@echo "$(BLUE)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "$(GREEN)â„¹ï¸  InformaÃ§Ãµes do Ambiente$(NC)"
	@echo "$(BLUE)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo ""
	@echo "$(YELLOW)ðŸŒ URLs:$(NC)"
	@echo "  AplicaÃ§Ã£o: http://localhost:8080"
	@echo "  Mailpit:   http://localhost:32770"
	@echo ""
	@echo "$(YELLOW)ðŸ—„ï¸  MySQL:$(NC)"
	@echo "  Host:     localhost (ou mysql dentro dos containers)"
	@echo "  Port:     3306"
	@echo "  Database: db_laravel"
	@echo "  User:     developer"
	@echo "  Password: 123456"
	@echo ""
	@echo "$(YELLOW)ðŸ”´ Redis:$(NC)"
	@echo "  Host: localhost (ou redis dentro dos containers)"
	@echo "  Port: 6379"
	@echo ""


##@ ðŸ§¼ Limpeza & Reset

clean: ## Limpa arquivos temporÃ¡rios
	@echo "$(GREEN)ðŸ§¼ Limpando arquivos temporÃ¡rios...$(NC)"
	docker compose exec php rm -rf storage/framework/cache/*
	docker compose exec php rm -rf storage/framework/sessions/*
	docker compose exec php rm -rf storage/framework/views/*
	@echo "$(GREEN)âœ… Limpeza concluÃ­da!$(NC)"

reset-hard: ## Reset completo do ambiente (âš ï¸ APAGA TUDO!)
	@echo "$(RED)âš ï¸âš ï¸âš ï¸  ATENÃ‡ÃƒO: Isso vai APAGAR TODOS OS DADOS! âš ï¸âš ï¸âš ï¸$(NC)"
	@echo "$(RED)Isso inclui: banco de dados, cache, volumes, etc.$(NC)"
	@read -p "Digite 'CONFIRMO' para continuar: " confirm; \
	if [ "$$confirm" = "CONFIRMO" ]; then \
		echo "$(YELLOW)Removendo dados antes de parar containers...$(NC)"; \
		docker compose exec php rm -rf vendor node_modules storage/logs/* 2>/dev/null || true; \
		echo "$(YELLOW)Parando containers e removendo volumes...$(NC)"; \
		docker compose down -v; \
		echo "$(GREEN)âœ… Reset completo realizado!$(NC)"; \
		echo "$(YELLOW)Execute 'make up' e 'make setup' para reconfigurar$(NC)"; \
	else \
		echo "Cancelado."; \
	fi

prune: ## Remove containers, volumes e imagens nÃ£o utilizados
	@echo "$(YELLOW)ðŸ§¹ Limpando Docker...$(NC)"
	docker system prune -af --volumes
	@echo "$(GREEN)âœ… Docker limpo!$(NC)"

